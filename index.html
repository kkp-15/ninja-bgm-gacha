<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BGMã‚¬ãƒãƒ£</title>

<!-- === Google Analytics (GA4) === -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-2LM85GJN0L');
</script>
<!-- ================================= -->

<style>
 /* â”€â”€ æ—¢å­˜ CSS ï¼ˆå¤‰ã‚ã‚‰ãšï¼‰ â”€â”€ */
 :root { --grad:linear-gradient(135deg,#ff7a00,#ffce00); }
 body  { font-family:sans-serif;text-align:center;margin:0;background:#fafafa; }
 h1    { margin:2rem 0;font-size:1.9rem; }
 /* ã‚¬ãƒãƒ£ãƒœã‚¿ãƒ³ãƒ»ãƒªãƒ³ã‚°ãƒ»ã‚«ãƒ¼ãƒ‰ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ etcâ€¦ å‰å›ã¨åŒã˜ */
 /* â€¦ï¼ˆçœç•¥ãªã—ã§è²¼ã‚Šä»˜ã‘æ¸ˆã¿ï¼‰â€¦ */
</style>
</head>
<body>
<h1>ğŸ² BGMã‚¬ãƒãƒ£</h1>

<button id="roll">
  <div id="finger">ğŸ‘‡</div>
  <span class="label">ã‚¬ãƒãƒ£ã‚’å›ã™</span>
  <small class="hint">ï¼ˆç´„1ç§’é•·æŠ¼ã—ï¼‰</small>
  <svg viewBox="0 0 180 180"><circle id="ring" cx="90" cy="90" r="80"/></svg>
</button>

<section id="result">
  <h2 id="title"></h2>
  <iframe id="player" allow="autoplay; encrypted-media" playsinline></iframe><br>
  <a id="req" class="btn" style="background:#4267B2">ğŸ¶ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæŠ•ç¨¿</a>
  <p id="how" style="margin-top:.6rem;font-size:.8rem;color:#666">
    ğŸ¥ YouTubeã‚¢ãƒ—ãƒªã§ <b>å…±æœ‰â†’ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</b><br>è²¼ã‚Šä»˜ã‘ã¦æŠ•ç¨¿ã—ã¦ãã ã•ã„
  </p>
</section>

<div id="toast">1 ç§’é•·æŠ¼ã—ã—ã¦ãã ã•ã„</div>

<footer class="x-footer">
  <a href="https://x.com/kkp_webninja" target="_blank" rel="noopener">@kkp_webninja</a>
</footer>

<script>
/* â”€â”€ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ 5 æ›² â”€â”€ */
window.PLAYLISTS = { playlists:[
  { id:"sO3IO8ITQbk", title:"Summer Chill Popï½œå¤æ°—åˆ†ãƒ©ãƒƒãƒ—ï¼†ãƒãƒƒãƒ—" },
  { id:"lY3x33Q9p7Y", title:"Lo-fi Hawaiian Loveï½œã‚¦ã‚¯ãƒ¬ãƒ¬BGM" },
  { id:"BYra5__dZt8", title:"Deep Ocean Beats" },
  { id:"7Col7jbU58I", title:"Retro City Chillwaveï½œ80â€™s ã‚·ãƒ³ã‚»ãƒ»ãƒãƒ«" },
  { id:"aR2wgXX1LKw", title:"Cozy Acoustic Hip-Hopï½œå¤œã‚«ãƒ•ã‚§BGM" }
] };

/* â”€â”€ DOM & çŠ¶æ…‹ â”€â”€ */
const ring   = document.getElementById('ring');
const btn    = document.getElementById('roll');
const reqBtn = document.getElementById('req');
const resBox = document.getElementById('result');
const titleEl= document.getElementById('title');
let   player = document.getElementById('player');
const toast  = document.getElementById('toast');

let timer,startTime; const longPress=1000,dashMax=502; let rolling=false;
let currentId = null;                  /* â˜… ç›´å‰ã«å†ç”Ÿã—ãŸ ID */

/* iframe ã‚’ä½œã‚Šç›´ã— */
function resetPlayer(){
  const newFrame = player.cloneNode();
  player.replaceWith(newFrame);
  player = newFrame;
}

/* â”€â”€ é•·æŠ¼ã—é–‹å§‹ â”€â”€ */
btn.addEventListener('pointerdown',e=>{
  if(rolling) return;
  startTime = Date.now();
  document.getElementById('finger').style.opacity=.2;
  ring.style.strokeDashoffset = dashMax;
  timer = requestAnimationFrame(progress);
  e.preventDefault();
});
btn.addEventListener('pointerup',cancel);
btn.addEventListener('pointerleave',cancel);
btn.addEventListener('pointercancel',cancel);
btn.addEventListener('contextmenu',e=>e.preventDefault());

function progress(){
  const r=Math.min((Date.now()-startTime)/longPress,1);
  ring.style.strokeDashoffset = dashMax*(1-r);
  if(r<1){timer=requestAnimationFrame(progress);} else {runGacha();}
}
function cancel(){
  cancelAnimationFrame(timer);
  ring.style.strokeDashoffset = dashMax;
  document.getElementById('finger').style.opacity=.8;
  if(Date.now()-startTime<longPress*0.6) showToast();
}
function showToast(){
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),1600);
}

/* â”€â”€ ã‚¬ãƒãƒ£ â”€â”€ */
function runGacha(){
  rolling = true;

  /* 1. ç¾åœ¨ã®æ›²ã‚’æ­¢ã‚ã‚‹ */
  resetPlayer();

  /* 2. â€œé€£ç¶šã—ãªã„â€ æ›²ã‚’æŠ½é¸ */
  const list = window.PLAYLISTS.playlists;
  let pick;
  do {
    pick = list[Math.floor(Math.random()*list.length)];
  } while (list.length > 1 && pick.id === currentId);   // â˜… åŒã˜IDãªã‚‰å¼•ãç›´ã—
  currentId = pick.id;                                  // â˜… ä»Šå›ã® ID ã‚’è¨˜éŒ²

  /* 3. å†ç”Ÿï¼†UIæ›´æ–° */
  titleEl.textContent = 'ğŸ§ ' + pick.title;
  player.src = `https://www.youtube.com/embed/${pick.id}?autoplay=1&playsinline=1&loop=1&playlist=${pick.id}&controls=1`;
  resBox.style.display = 'block';

  gtag('event','gacha_play',{video_id:pick.id,title:pick.title});
  makeIntentLink();

  ring.style.strokeDashoffset = dashMax;
  document.getElementById('finger').style.opacity = .8;
  rolling = false;
}

/* â”€â”€ æŠ•ç¨¿ãƒªãƒ³ã‚¯ â”€â”€ */
function makeIntentLink(){
  const template=`@kkp_webninja #BGMã‚¬ãƒãƒ£è¿½åŠ å¸Œæœ›\n`+
                 `â–¶ï¸ ï¼ˆã“ã“ã« YouTube ãƒªãƒ³ã‚¯ã‚’è²¼ã£ã¦ãã ã•ã„ï¼‰\n`+
                 `ã”æ„Ÿæƒ³ã‚„ã‚¸ãƒ£ãƒ³ãƒ«: `;
  reqBtn.href=`https://twitter.com/intent/tweet?text=${encodeURIComponent(template)}`;
  reqBtn.target='_blank'; reqBtn.rel='noopener';
  reqBtn.onclick=()=>gtag('event','tweet_request');
}
</script>
</body>
</html>
