<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BGMガチャ</title>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-2LM85GJN0L');
</script>

<style>
 :root { --grad:linear-gradient(135deg,#ff7a00,#ffce00); }
 body  { font-family:sans-serif;text-align:center;margin:0;background:#fafafa; }
 h1    { margin:2rem 0;font-size:1.9rem; }
 /* …（前回と同じ CSS。省略せず貼る場合は全文残してください）… */
</style>
</head>
<body>
<h1>🎲 BGMガチャ</h1>

<!-- ガチャボタン -->
<button id="roll">
  <div id="finger">👇</div>
  <span class="label">ガチャを回す</span>
  <small class="hint">（約1秒長押し）</small>
  <svg viewBox="0 0 180 180"><circle id="ring" cx="90" cy="90" r="80"/></svg>
</button>

<!-- 結果カード -->
<section id="result">
  <h2 id="title"></h2>
  <iframe id="player" allow="autoplay; encrypted-media" playsinline></iframe><br>
  <a id="req" class="btn" style="background:#000">𝕏 リクエスト投稿</a>
  <p id="how" style="margin-top:.6rem;font-size:.8rem;color:#666">
    🎥 YouTubeアプリで <b>共有→リンクをコピー</b><br>貼り付けて投稿してください
  </p>
</section>

<div id="toast">1 秒長押ししてください</div>

<!-- フッター -->
<footer class="x-footer">
  <a href="https://x.com/kkp_webninja" target="_blank" rel="noopener">𝕏 @kkp_webninja</a>
</footer>

<script>
/* 🎶 7 曲のプレイリスト（★ 新曲を末尾に追加） */
window.PLAYLISTS = { playlists: [
  { id:"sO3IO8ITQbk", title:"Summer Chill Pop｜夏気分ラップ＆ポップ" },
  { id:"lY3x33Q9p7Y", title:"Lo-fi Hawaiian Love｜ウクレレBGM" },
  { id:"BYra5__dZt8", title:"Deep Ocean Beats" },
  { id:"xvcXZbvYf0s", title:"Chill Café Beats｜朝のコーヒータイム" },
  { id:"W0lUBVcvJiw", title:"Night City Synthwave｜深夜ドライブ用" },
  { id:"nlzxWWjB-ik", title:"Gentle Rain Piano｜雨音とピアノの癒し" },
  { id:"76H5yiwp4Gc", title:"Pacific Coast Drive｜波音シンセウェーブ" }  /* ★ 追加 */
] };

/* === 以下 JavaScript ロジックは前回と同じ === */
const ring=document.getElementById('ring');
const btn=document.getElementById('roll');
const reqBtn=document.getElementById('req');
const resBox=document.getElementById('result');
const titleEl=document.getElementById('title');
let   player=document.getElementById('player');
const toast=document.getElementById('toast');
let timer,startTime;const longPress=1000,dashMax=502;let rolling=false;
let lastId=null;
function resetPlayer(){const f=player.cloneNode();player.replaceWith(f);player=f;}
btn.addEventListener('pointerdown',e=>{
  if(rolling)return;
  startTime=Date.now();document.getElementById('finger').style.opacity=.2;
  ring.style.strokeDashoffset=dashMax;
  timer=requestAnimationFrame(progress);e.preventDefault();
});
btn.addEventListener('pointerup',cancel);
btn.addEventListener('pointerleave',cancel);
btn.addEventListener('pointercancel',cancel);
btn.addEventListener('contextmenu',e=>e.preventDefault());
function progress(){const r=Math.min((Date.now()-startTime)/longPress,1);
  ring.style.strokeDashoffset=dashMax*(1-r);
  if(r<1){timer=requestAnimationFrame(progress);}else{runGacha();}
}
function cancel(){cancelAnimationFrame(timer);ring.style.strokeDashoffset=dashMax;
  document.getElementById('finger').style.opacity=.8;
  if(Date.now()-startTime<longPress*0.6)showToast();}
function showToast(){toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),1600);}
function runGacha(){
  rolling=true;
  const list=window.PLAYLISTS.playlists;
  const pool=list.length>1?list.filter(p=>p.id!==lastId):list;
  const pick=pool[Math.floor(Math.random()*pool.length)];
  lastId=pick.id;
  resetPlayer();
  titleEl.textContent='🎧 '+pick.title;
  player.src=`https://www.youtube.com/embed/${pick.id}?autoplay=1&playsinline=1&loop=1&playlist=${pick.id}&controls=1`;
  resBox.style.display='block';
  gtag('event','gacha_play',{video_id:pick.id,title:pick.title});
  makeIntentLink();
  ring.style.strokeDashoffset=dashMax;
  document.getElementById('finger').style.opacity=.8;
  rolling=false;
}
function makeIntentLink(){
  const txt=`@kkp_webninja #BGMガチャ追加希望\n▶️ （ここに YouTube リンクを貼ってください）\nご感想やジャンル: `;
  reqBtn.href=`https://twitter.com/intent/tweet?text=${encodeURIComponent(txt)}`;
  reqBtn.target='_blank';reqBtn.rel='noopener';
  reqBtn.onclick=()=>gtag('event','tweet_request');
}
</script>
</body></html>
