<!DOCTYPE html><html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BGMガチャ</title>

<!-- === Google Analytics (GA4) === -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-2LM85GJN0L');
</script>
<!-- ============================== -->

<style>
 :root { --grad:linear-gradient(135deg,#ff7a00,#ffce00); }
 body  { font-family:sans-serif;text-align:center;margin:0;background:#fafafa; }
 h1    { margin:2rem 0;font-size:1.9rem; }

 /* ── ガチャボタン ── */
 #roll{
  position:relative;width:170px;height:170px;margin:40px auto 0;
  border:none;border-radius:50%;color:#fff;background:var(--grad);
  box-shadow:0 8px 16px rgba(0,0,0,.2);cursor:pointer;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:.35rem;-webkit-touch-callout:none;
 }
 #finger{font-size:2.6rem;opacity:.8;animation:pulse 1.2s infinite;}
 @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(.9);} }
 #roll .label{font-size:1.05rem;line-height:1.2;}
 #roll .hint {font-size:.8rem;opacity:.8;line-height:1;}
 #roll svg{position:absolute;inset:0;transform:rotate(-90deg);}
 #ring{stroke:#fff;stroke-width:12;fill:none;stroke-dasharray:502;
       stroke-dashoffset:502;transition:stroke-dashoffset .06s linear;}

 /* ── 結果カード ── */
 #result{display:none;margin-top:32px;}
 iframe{width:100%;max-width:560px;height:315px;border:none;}
 .btn  {display:inline-block;padding:.85rem 2.2rem;font-size:1rem;text-decoration:none;
        border:none;border-radius:99rem;background:var(--grad);color:#fff;
        box-shadow:0 6px 12px rgba(0,0,0,.15);cursor:pointer;margin:.4rem;}

 /* ── X フッターボタン ── */
 .x-footer{
   position:fixed;left:50%;bottom:12px;transform:translateX(-50%);
   z-index:50;
 }
 .x-footer a{
   display:inline-block;padding:.65rem 1.6rem;font-size:.9rem;font-weight:bold;
   border-radius:99rem;background:#000;color:#fff;text-decoration:none;
   box-shadow:0 4px 10px rgba(0,0,0,.25);
   transition:transform .2s;
 }
 .x-footer a:hover{transform:scale(1.06);}

 /* ── トースト ── */
 #toast{position:fixed;left:50%;bottom:80px;transform:translateX(-50%);
        background:#333;color:#fff;font-size:.9rem;padding:.6rem 1.4rem;
        border-radius:8px;opacity:0;pointer-events:none;transition:opacity .3s;}
 #toast.show{opacity:.9;}
 #how{font-size:.8rem;color:#666;margin-top:8px;}
</style>
</head>
<body>
<h1>🎲 BGMガチャ</h1>

<button id="roll">
  <div id="finger">👇</div>
  <span class="label">ガチャを回す</span>
  <small class="hint">（約1秒長押し）</small>
  <svg viewBox="0 0 180 180"><circle id="ring" cx="90" cy="90" r="80"/></svg>
</button>

<p id="how">🎥 YouTubeアプリで <b>共有→リンクをコピー</b><br>↓<br>
   リクエスト投稿で貼り付けてください</p>

<section id="result">
  <h2 id="title"></h2>
  <iframe id="player" allow="autoplay; encrypted-media" playsinline></iframe><br>
  <button id="retry" class="btn">もう一回！</button>
  <a id="req" class="btn" style="background:#4267B2">🎶 リクエスト投稿</a>
</section>

<div id="toast">1 秒長押ししてください</div>

<!-- 画面最下部に固定：X リンク -->
<div class="x-footer">
  <a href="https://x.com/kkp_webninja" target="_blank" rel="noopener">@kkp_webninja</a>
</div>

<script>
/* ── 動画ID & タイトル ── */
window.PLAYLISTS = { playlists: [
  { id:"sO3IO8ITQbk", title:"Summer Chill Pop｜夏気分ラップ＆ポップ" },
  { id:"lY3x33Q9p7Y", title:"Lo‑fi Hawaiian Love｜ウクレレBGM" },
  { id:"BYra5__dZt8", title:"Deep Ocean Beats" }
] };

/* ── DOM & 状態 ---- */
const ring   = document.getElementById('ring');
const btn    = document.getElementById('roll');
const retry  = document.getElementById('retry');
const reqBtn = document.getElementById('req');
const resBox = document.getElementById('result');
const titleEl= document.getElementById('title');
const player = document.getElementById('player');
const toast  = document.getElementById('toast');

let timer,startTime; const longPress=1000,dashMax=502; let rolling=false;

/* ── 長押し判定 ---- */
btn.addEventListener('pointerdown',e=>{
  if(rolling) return;
  startTime=Date.now();document.getElementById('finger').style.opacity=.2;
  timer=requestAnimationFrame(progress);e.preventDefault();
});
btn.addEventListener('pointerup',cancel);
btn.addEventListener('pointerleave',cancel);
btn.addEventListener('pointercancel',cancel);
btn.addEventListener('contextmenu',e=>e.preventDefault());

function progress(){
  const r=Math.min((Date.now()-startTime)/longPress,1);
  ring.style.strokeDashoffset=dashMax*(1-r);
  if(r<1){timer=requestAnimationFrame(progress);}else{runGacha();}
}
function cancel(){
  cancelAnimationFrame(timer);
  ring.style.strokeDashoffset=dashMax;
  document.getElementById('finger').style.opacity=.8;
  if(Date.now()-startTime<longPress*0.6) showToast();
}
function showToast(){toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),1600);}

/* ── ガチャ ---- */
function runGacha(){
  if(rolling) return;rolling=true;
  const list=window.PLAYLISTS.playlists;
  const pick=list[Math.floor(Math.random()*list.length)];

  titleEl.textContent='🎧 '+pick.title;
  player.src=`https://www.youtube.com/embed/${pick.id}?autoplay=1&playsinline=1&loop=1&playlist=${pick.id}&controls=1`;
  resBox.style.display='block';

  gtag('event','gacha_play',{video_id:pick.id,title:pick.title});
  makeIntentLink();rolling=false;
}

/* ── リクエスト投稿リンク ---- */
function makeIntentLink(){
  const template=`@kkp_webninja #BGMガチャ追加希望\n`+
                 `▶️ （ここに YouTube リンクを貼ってください）\n`+
                 `ご感想やジャンル: `;
  reqBtn.href   = `https://twitter.com/intent/tweet?text=${encodeURIComponent(template)}`;
  reqBtn.target = '_blank';reqBtn.rel='noopener';
  reqBtn.onclick= ()=> gtag('event','tweet_request');
}

/* ── リセット ---- */
retry.onclick=()=>{resBox.style.display='none';ring.style.strokeDashoffset=dashMax;
                   gtag('event','retry_click');};
</script>
</body></html>
